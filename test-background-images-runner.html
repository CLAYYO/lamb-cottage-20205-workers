<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Background Image Test Runner</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .instructions {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 10px 10px 0;
        }
        .button:hover {
            background: #1976d2;
        }
        .button.secondary {
            background: #757575;
        }
        .button.secondary:hover {
            background: #616161;
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        .log-success {
            background: #e8f5e8;
            color: #2e7d32;
        }
        .log-error {
            background: #ffebee;
            color: #c62828;
        }
        .log-warn {
            background: #fff3e0;
            color: #ef6c00;
        }
        .log-info {
            background: #f3f3f3;
            color: #333;
        }
        .summary {
            margin-top: 20px;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 4px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Background Image Test Runner</h1>
        
        <div class="instructions">
            <h3>Instructions:</h3>
            <ol>
                <li>Make sure you're logged into the admin panel</li>
                <li>Navigate to the <strong>Content Editor</strong> page</li>
                <li>Click "Run Tests" to check background image functionality</li>
                <li>Review the results below</li>
            </ol>
        </div>
        
        <div class="actions">
            <button class="button" onclick="openAdminPage()">Open Admin Content Page</button>
            <button class="button" onclick="runTests()">Run Tests</button>
            <button class="button secondary" onclick="clearResults()">Clear Results</button>
            <button class="button secondary" onclick="exportResults()">Export Results</button>
        </div>
        
        <div id="results" class="results" style="display: none;">
            <h3>Test Results:</h3>
            <div id="log-container"></div>
            <div id="summary-container"></div>
        </div>
    </div>

    <script>
        let testResults = null;
        
        function openAdminPage() {
            window.open('/admin/content', '_blank');
        }
        
        async function runTests() {
            const resultsDiv = document.getElementById('results');
            const logContainer = document.getElementById('log-container');
            const summaryContainer = document.getElementById('summary-container');
            
            resultsDiv.style.display = 'block';
            logContainer.innerHTML = '<div class="log-info">Loading test script...</div>';
            summaryContainer.innerHTML = '';
            
            try {
                // Load and execute the test script
                const response = await fetch('/test-background-images-console.js');
                const scriptContent = await response.text();
                
                // Create a new script element and execute it
                const script = document.createElement('script');
                script.textContent = scriptContent;
                document.head.appendChild(script);
                
                // Wait a moment for tests to complete
                setTimeout(() => {
                    if (window.backgroundImageTestResults) {
                        displayResults(window.backgroundImageTestResults);
                    } else {
                        logContainer.innerHTML = '<div class="log-error">Tests did not complete. Check browser console for details.</div>';
                    }
                }, 3000);
                
            } catch (error) {
                logContainer.innerHTML = `<div class="log-error">Error loading test script: ${error.message}</div>`;
            }
        }
        
        function displayResults(results) {
            const logContainer = document.getElementById('log-container');
            const summaryContainer = document.getElementById('summary-container');
            
            testResults = results;
            
            // Display log entries
            logContainer.innerHTML = '';
            results.results.forEach(entry => {
                const div = document.createElement('div');
                div.className = `log-entry log-${entry.type}`;
                div.textContent = `[${entry.timestamp}] ${entry.message}`;
                logContainer.appendChild(div);
            });
            
            // Display summary
            summaryContainer.innerHTML = `
                <div class="summary">
                    <h4>Summary:</h4>
                    <p>Total Tests: ${results.total}</p>
                    <p style="color: #2e7d32;">‚úÖ Successes: ${results.successes}</p>
                    <p style="color: #ef6c00;">‚ö†Ô∏è Warnings: ${results.warnings}</p>
                    <p style="color: #c62828;">‚ùå Errors: ${results.errors}</p>
                    ${results.errors === 0 ? 
                        '<p style="color: #2e7d32; font-weight: bold;">üéâ All tests passed!</p>' : 
                        '<p style="color: #c62828; font-weight: bold;">üîß Issues found. Check errors above.</p>'
                    }
                </div>
            `;
        }
        
        function clearResults() {
            document.getElementById('results').style.display = 'none';
            document.getElementById('log-container').innerHTML = '';
            document.getElementById('summary-container').innerHTML = '';
            testResults = null;
        }
        
        function exportResults() {
            if (!testResults) {
                alert('No test results to export. Run tests first.');
                return;
            }
            
            const dataStr = JSON.stringify(testResults, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `background-image-test-results-${new Date().toISOString().slice(0,19).replace(/:/g, '-')}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
        }
        
        // Auto-run tests if we're on the admin content page
        if (window.location.pathname === '/admin/content') {
            setTimeout(runTests, 1000);
        }
    </script>
</body>
</html>